<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Админ-панель конфигуратора</title>
    <link rel="stylesheet" href="css/styles.css">

    <script src="js/auth.js"></script>
</head>
<body>
<header>
    <h1>Админ-панель конфигуратора</h1>
    <button id="addTextureBtn" class="button">Добавить текстуру</button>
    <button id="addPatternBtn" class="button">Добавить дизайн-проект</button>
    <button id="uploadSurveyTemplateBtn" class="button">Загрузить шаблон опросного листа</button>
</header>

<div class="tabs">
    <button class="tab-link active" data-tab="door">Дверь</button>
    <button class="tab-link" data-tab="walls">Стены</button>
    <button class="tab-link" data-tab="floor">Пол</button>
    <button class="tab-link" data-tab="bumper">Отбойник</button>
    <button class="tab-link" data-tab="ceilingPattern">Рисунок потолка</button>
    <button class="tab-link" data-tab="ceiling">Потолок</button>
    <button class="tab-link" data-tab="controlPanel">Панель управления</button>
    <button class="tab-link" data-tab="indicationBoard">Табло индикации</button>
    <button class="tab-link" data-tab="handrails">Перила</button>
    <button class="tab-link" data-tab="patterns">Шаблоны</button>
</div>

<div class="tab-contents">
    <div class="tab-content active" id="door">
        <h2 class="title">Текстуры для двери</h2>
        <div class="texture-grid">
            <!-- Иконки загрузятся автоматически -->
        </div>
    </div>

    <div class="tab-content" id="walls">
        <h2 class="title">Текстуры для стен</h2>
        <div class="texture-grid">
            <!-- Иконки загрузятся автоматически -->
        </div>
    </div>

    <div class="tab-content" id="floor">
        <h2 class="title">Текстуры для пола</h2>
        <div class="texture-grid">
            <!-- Иконки загрузятся автоматически -->
        </div>
    </div>

    <div class="tab-content" id="bumper">
        <h2 class="title">Текстуры для отбойника</h2>
        <div class="texture-grid">
            <!-- Иконки загрузятся автоматически -->
        </div>
    </div>

    <div class="tab-content" id="ceilingPattern">
        <h2 class="title">Рисунок потолка</h2>
        <div class="texture-grid">
            <!-- Иконки загрузятся автоматически -->
        </div>
    </div>

    <div class="tab-content" id="ceiling">
        <h2 class="title">Текстуры для потолка</h2>
        <div class="texture-grid">
            <!-- Иконки загрузятся автоматически -->
        </div>
    </div>

    <div class="tab-content" id="controlPanel">
        <h2 class="title">Текстуры для панели управления</h2>
        <div class="texture-grid">
            <!-- Иконки загрузятся автоматически -->
        </div>
    </div>

    <div class="tab-content" id="indicationBoard">
        <h2 class="title">Текстуры для табла индикации</h2>
        <div class="texture-grid">
            <!-- Иконки загрузятся автоматически -->
        </div>
    </div>

    <div class="tab-content" id="handrails">
        <h2 class="title">Текстуры для перил</h2>
        <div class="texture-grid">
            <!-- Иконки загрузятся автоматически -->
        </div>
    </div>

    <div class="tab-content" id="patterns">
        <div class="design-project_header">
            <h2 class="title">Дизайн-проекты</h2>
            <button id="addDesignProjectBtn" class="small-button inlineButton">Добавить группу</button>
        </div>
    
        <div class="search-field">
        <p >Показать:</p>
        <select class="search-select" id="designProjectSelect">
       
        </select>
        </div>
    
        <!-- Модальное окно -->
    <div id="designProjectModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-button" id="closeModal">&times;</span>
            <h2>Добавить/Изменить группу</h2>
            <input class="textInput" type="text" id="projectNameInput" placeholder="Введите название проекта">
            <div class="modal__footer">
                <button id="confirmAddProjectBtn" class="modal-button">ОК</button>
                <button id="cancelAddProjectBtn" class="modal-button">Отмена</button>
            </div>
        </div>
    </div>
    </div>

</div>

<!-- Модальное окно для отображения деталей текстуры -->
<div id="textureModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2 class="title">Детали текстуры</h2>
        <div id="textureDetails"></div>
        <button class="small-button" id="editTextureBtn">Изменить текстуру</button>
        <button class="small-button" id="deleteTextureBtn">Удалить текстуру</button>
    </div>
</div>

<div id="uploadTemplateModal" class="modal">
    <div class="modal-content">
        <span class="close" id="uploadTemplateClose">&times;</span>
        <h2>Загрузить шаблон опросного листа (.docx)</h2>
        <div id="dropZone" class="drop-zone">
            <p>Перетащите .docx файл сюда или нажмите кнопку для выбора файла.</p>
            <input type="file" id="fileInput" accept=".docx" style="display: none;" />
            <button id="chooseFileBtn" class="button">Выбрать файл</button>
            <!-- Блок для отображения информации о выбранном файле -->
            <div id="fileInfo"></div>
        </div>
        <!-- Кнопка отправки файла -->
        <button id="sendFileBtn" class="button" disabled>Отправить файл</button>
    </div>
</div>

<script src="js/script.js"></script>
<script>
    // Открытие модального окна по нажатию на кнопку "Загрузить шаблон опросного листа"
    document.getElementById('uploadSurveyTemplateBtn').addEventListener('click', () => {
        document.getElementById('uploadTemplateModal').style.display = 'block';
    });

    // Закрытие модального окна
    document.getElementById('uploadTemplateClose').addEventListener('click', closeUploadModal);
    function closeUploadModal() {
        document.getElementById('uploadTemplateModal').style.display = 'none';
        // Сброс выбранного файла и информации
        selectedFile = null;
        document.getElementById('fileInfo').innerHTML = '';
        document.getElementById('sendFileBtn').disabled = true;
    }

    let selectedFile = null;
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const chooseFileBtn = document.getElementById('chooseFileBtn');
    const sendFileBtn = document.getElementById('sendFileBtn');
    const fileInfoDiv = document.getElementById('fileInfo');

    // Обработка событий drag’n’drop
    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('dragover');
    });
    dropZone.addEventListener('dragleave', (e) => {
        e.preventDefault();
        dropZone.classList.remove('dragover');
    });
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('dragover');
        if (e.dataTransfer.files.length > 0) {
            setSelectedFile(e.dataTransfer.files[0]);
        }
    });

    // Выбор файла через диалоговое окно
    chooseFileBtn.addEventListener('click', () => {
        fileInput.click();
    });
    fileInput.addEventListener('change', () => {
        if (fileInput.files.length > 0) {
            setSelectedFile(fileInput.files[0]);
        }
    });

    // Функция для установки выбранного файла и отображения информации о нем
    function setSelectedFile(file) {
        // Проверка расширения файла (можно добавить дополнительную валидацию)
        if (!file.name.endsWith('.docx')) {
            alert('Выберите файл в формате .docx');
            return;
        }
        selectedFile = file;
        fileInfoDiv.innerHTML = `<p>Выбран файл: <strong>${file.name}</strong> (${(file.size / 1024).toFixed(2)} KB)</p>`;
        sendFileBtn.disabled = false;
    }

    // Отправка файла по нажатию на кнопку "Отправить файл"
    sendFileBtn.addEventListener('click', () => {
        if (!selectedFile) {
            alert('Файл не выбран');
            return;
        }
        uploadFile(selectedFile);
    });

    // Функция отправки файла на бекенд с использованием FormData
    function uploadFile(file) {
        const formData = new FormData();
        formData.append('file', file);

        fetch('http://localhost:8090/api/v1/files/document-template', {
            method: 'POST',
            body: formData
        })
            .then(response => {
                if (response.ok) {
                    alert('Файл успешно загружен');
                    closeUploadModal();
                } else {
                    throw new Error('Ошибка при загрузке файла');
                }
            })
            .catch(err => {
                console.error('Ошибка загрузки файла', err);
                alert('Ошибка загрузки файла');
            });
    }
</script>
<script src="./js/script.js"></script>
<script type="module" src="./js/patterns/animation/designProjectButtons.js"></script>
</body>
</html>